const getTeddiesById=async id=>{const response=await fetch("api/teddies/"+id);return await response.json()},deconsteFromCartFunction=(id,color)=>{const cart=JSON.parse(localStorage.getItem("cart")),result=cart.filter(item=>item._id!==id||item.color!==color);0!==result.length?localStorage.setItem("cart",JSON.stringify(result)):localStorage.removeItem("cart"),location.reload()},insertTeddy=(id,imgSource,name,color,quantity,price)=>{const rowProduct=document.createElement("div");rowProduct.setAttribute("class","row rowProduct");const columnSm=document.createElement("div");columnSm.setAttribute("class","col");const insertName=document.createElement("h3");insertName.innerHTML=name,columnSm.appendChild(insertName),rowProduct.appendChild(columnSm);const columnXs=document.createElement("div");columnXs.setAttribute("class","col-xs");const imageWrapper=document.createElement("div");imageWrapper.setAttribute("class","img-wrap");const imageContainer=document.createElement("img");imageContainer.setAttribute("class","img"),imageContainer.setAttribute("src",imgSource),imageWrapper.appendChild(imageContainer),columnXs.appendChild(imageWrapper),rowProduct.appendChild(columnXs),document.getElementById("productList").appendChild(rowProduct);const columnXsColor=document.createElement("div");columnXsColor.setAttribute("class","col-xs");const itemColor=document.createElement("p");itemColor.innerHTML="Color: "+color,columnXsColor.appendChild(itemColor),rowProduct.appendChild(columnXsColor);const columnXsQuantity=document.createElement("div");columnXsQuantity.setAttribute("class","col-xs");const itemQuantity=document.createElement("p");itemQuantity.innerHTML="Quantity: "+quantity+" unit. ",columnXsQuantity.appendChild(itemQuantity),rowProduct.appendChild(columnXsQuantity);const columnXsPrice=document.createElement("div");columnXsPrice.setAttribute("class","col-xs");const itemPrice=document.createElement("p");itemPrice.innerHTML=quantity*price/100+".00 EUR",columnXsPrice.appendChild(itemPrice),rowProduct.appendChild(columnXsPrice);const rowButtons=document.createElement("div");rowButtons.setAttribute("class","container productContols");const buttonsContainer=document.createElement("div");buttonsContainer.setAttribute("class","btn-group");const removeButton=document.createElement("a");removeButton.setAttribute("class","btn btn-light"),removeButton.innerHTML="Remove Article",removeButton.addEventListener("click",()=>deconsteFromCartFunction(id,color)),buttonsContainer.appendChild(removeButton),rowButtons.appendChild(buttonsContainer),rowProduct.appendChild(rowButtons)},buildMyCart=()=>{const cart=JSON.parse(localStorage.getItem("cart"));cart&&(document.getElementById("empty-cart-message").style.display="none",document.getElementById("checkout-form").style.display="block"),cart.map(async c=>{const teddy=await getTeddiesById(c._id);insertTeddy(teddy._id,teddy.imageUrl,teddy.name,c.color,c.quantity,teddy.price),total(teddy.price/100*c.quantity)})};buildMyCart();const total=price=>{const start=+document.getElementById("total").innerHTML;document.getElementById("total").innerHTML=start+ +price+".00 "},validate=()=>{const firstName=document.getElementById("first-name").value,nameRGEX=/^[a-zA-Z ]+$/,firstNameResult=nameRGEX.test(firstName),lastName=document.getElementById("last-name").value,lastNameResult=nameRGEX.test(lastName),email=document.getElementById("email").value,emailRGEX=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,emailResult=emailRGEX.test(email),street=document.getElementById("street").value,streetRGEX=/^[0-9]{1,3}(?:(?:[,. ]){1}[-a-zA-Zàâäéèêëïîôöùûüç]+)*$/,streetResult=streetRGEX.test(street),city=document.getElementById("city").value,cityRGEX=/^[a-zA-Z ]+$/,cityResult=cityRGEX.test(city),contact_firstName=firstName,contact_lastName=lastName,contact_adress=street,contact_city=city,contact_email=email;return!(0==firstNameResult|0==lastNameResult|0==emailResult|0==streetResult|0==cityResult)||(alert("Some of the data you entered are not at the right format: Please enter correct contact details"),!1)},order=[],cart=JSON.parse(localStorage.getItem("cart"));cart.map(async c=>{await getTeddiesById(c._id),order.push(c._id)});const confirmation=()=>{const orderNumber=Math.floor(89999999*Math.random()+1e7),orderTotal=+document.getElementById("total").innerHTML;localStorage.setItem("orderConfirmation",JSON.stringify({orderNumber:orderNumber,orderTotal:orderTotal})),window.location.replace("order.html")},checkout=()=>{if(0==validate())return!1;{const form=JSON.stringify({contact:{firstName:document.getElementById("first-name").value,lastName:document.getElementById("last-name").value,address:document.getElementById("street").value,city:document.getElementById("city").value,email:document.getElementById("email").value},products:order});fetch("api/teddies/order",{method:"POST",headers:{"Content-type":"application/json"},body:form}).then(resp=>console.log(resp)),confirmation()}};document.getElementById("submit-button").addEventListener("click",()=>checkout());